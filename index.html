<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GROUNDWORK — Training Planner</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;600;700;900&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0a0a0a;
    --surface: #111111;
    --surface2: #1a1a1a;
    --border: #222222;
    --text: #e8e4dc;
    --muted: #666666;
    --accent: #c8a96e;
    --accent-dim: #8a7148;
    --danger: #b34444;
    --mono: 'Courier New', monospace;
  }

  html { scroll-behavior: smooth; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Barlow', sans-serif;
    font-weight: 300;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1000;
    opacity: 0.6;
  }

  header {
    border-bottom: 1px solid var(--border);
    padding: 28px 48px;
    display: flex;
    align-items: baseline;
    gap: 16px;
  }

  .logo {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 22px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
  }

  .logo-sub {
    font-size: 11px;
    letter-spacing: 0.15em;
    color: var(--muted);
    text-transform: uppercase;
  }

  main {
    max-width: 900px;
    margin: 0 auto;
    padding: 64px 48px 120px;
  }

  .section-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  h1 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: clamp(36px, 6vw, 64px);
    line-height: 1;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  h1 span { color: var(--accent); }

  .subtitle {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 48px;
    line-height: 1.6;
  }

  .goal-presets {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 32px;
  }

  .preset-btn {
    padding: 8px 14px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 12px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.15s;
  }

  .preset-btn:hover {
    border-color: var(--accent-dim);
    color: var(--accent);
    background: rgba(200, 169, 110, 0.04);
  }

  .preset-btn.active {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(200, 169, 110, 0.08);
  }

  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }

  .form-group { display: flex; flex-direction: column; gap: 8px; }
  .form-group.full { grid-column: 1 / -1; }

  label {
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    font-weight: 500;
  }

  input, select, textarea {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 14px 16px;
    font-family: 'Barlow', sans-serif;
    font-size: 14px;
    font-weight: 400;
    outline: none;
    transition: border-color 0.2s, background 0.2s;
    width: 100%;
  }

  input:focus, select:focus, textarea:focus {
    border-color: var(--accent-dim);
    background: var(--surface2);
  }

  select {
    appearance: none;
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23666' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    padding-right: 40px;
  }

  select option { background: #111; }
  textarea { resize: vertical; min-height: 100px; line-height: 1.6; }

  .submit-btn {
    background: var(--accent);
    color: #0a0a0a;
    border: none;
    padding: 18px 40px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
  }

  .submit-btn:hover:not(:disabled) {
    background: #d4b87c;
    transform: translateY(-1px);
  }

  .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .submit-btn.loading .btn-text { display: none; }
  .submit-btn .btn-loading { display: none; }
  .submit-btn.loading .btn-loading { display: block; }

  .divider {
    height: 1px;
    background: var(--border);
    margin: 64px 0;
    position: relative;
  }

  .divider::after {
    content: attr(data-label);
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background: var(--bg);
    padding: 0 16px;
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
  }

  #output-section { display: none; }
  #output-section.visible { display: block; animation: fadeIn 0.4s ease; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .plan-header {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 24px;
    align-items: start;
    margin-bottom: 40px;
    padding-bottom: 40px;
    border-bottom: 1px solid var(--border);
  }

  .plan-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 48px;
    line-height: 1;
    text-transform: uppercase;
  }

  .plan-meta { display: flex; flex-direction: column; gap: 4px; text-align: right; }
  .plan-meta span { font-size: 12px; color: var(--muted); letter-spacing: 0.05em; }
  .plan-meta strong {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px;
    font-weight: 600;
    color: var(--accent);
  }

  .stats-bar {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: var(--border);
    margin-bottom: 40px;
  }

  .stat-item {
    background: var(--surface);
    padding: 20px 24px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .stat-label {
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .stat-value {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 24px;
    color: var(--accent);
  }

  #plan-content { font-size: 14px; line-height: 1.8; }

  #plan-content h2 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 22px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--accent);
    margin: 48px 0 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border);
  }

  #plan-content h2:first-child { margin-top: 0; }

  #plan-content h3 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 16px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text);
    margin: 28px 0 10px;
  }

  #plan-content p { margin-bottom: 16px; color: #c4bfb4; }

  #plan-content ul, #plan-content ol {
    padding-left: 0;
    margin-bottom: 20px;
    list-style: none;
  }

  #plan-content li {
    padding: 8px 0 8px 24px;
    position: relative;
    border-bottom: 1px solid var(--border);
    font-size: 13.5px;
    color: #c4bfb4;
  }

  #plan-content ul li::before {
    content: '—';
    position: absolute;
    left: 0;
    color: var(--accent-dim);
  }

  #plan-content ol { counter-reset: step; }
  #plan-content ol li { counter-increment: step; }
  #plan-content ol li::before {
    content: counter(step, decimal-leading-zero);
    position: absolute;
    left: 0;
    color: var(--accent-dim);
    font-family: var(--mono);
    font-size: 11px;
    top: 10px;
  }

  #plan-content strong { color: var(--text); font-weight: 600; }

  #plan-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 24px;
    font-size: 13px;
  }

  #plan-content th {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    padding: 10px 14px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  #plan-content td {
    padding: 12px 14px;
    border-bottom: 1px solid var(--border);
    color: #c4bfb4;
    vertical-align: top;
  }

  #plan-content tr:hover td { background: var(--surface); }

  .loading-state {
    display: flex;
    align-items: center;
    gap: 12px;
    color: var(--muted);
    font-size: 13px;
    letter-spacing: 0.05em;
    padding: 40px 0;
  }

  .loading-dots span {
    display: inline-block;
    width: 4px;
    height: 4px;
    background: var(--accent);
    border-radius: 50%;
    animation: dot 1.2s infinite;
    margin-right: 4px;
  }

  .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
  .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes dot {
    0%, 80%, 100% { opacity: 0.2; transform: scale(0.8); }
    40% { opacity: 1; transform: scale(1); }
  }

  .error-msg {
    background: rgba(179, 68, 68, 0.08);
    border: 1px solid var(--danger);
    padding: 20px 24px;
    color: #d47474;
    font-size: 13px;
    line-height: 1.6;
  }

  @media (max-width: 640px) {
    header { padding: 20px 24px; }
    main { padding: 40px 24px 80px; }
    .form-grid { grid-template-columns: 1fr; }
    .plan-header { grid-template-columns: 1fr; }
    .plan-meta { text-align: left; }
    .stats-bar { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">Groundwork</div>
  <div class="logo-sub">Performance Planning System</div>
</header>

<main>
  <div class="input-section">
    <div class="section-label">Doelstelling</div>
    <h1>Definieer je <span>doel</span></h1>
    <p class="subtitle">Geef je doel in en krijg een op maat gemaakt trainingsplan. Van selectietrajecten tot sportieve prestaties.</p>

    <div class="goal-presets">
      <button class="preset-btn active" onclick="setPreset(this, 'Navy SEALs (BUD/S selectie)')">Navy SEALs</button>
      <button class="preset-btn" onclick="setPreset(this, 'Marine Corps OCS')">Marine Corps</button>
      <button class="preset-btn" onclick="setPreset(this, 'Politie / Defensie fitness test')">Politie / Defensie</button>
      <button class="preset-btn" onclick="setPreset(this, 'Marathon sub 3 uur')">Marathon sub-3</button>
      <button class="preset-btn" onclick="setPreset(this, 'Ironman triathlon voltooien')">Ironman</button>
      <button class="preset-btn" onclick="setPreset(this, '')">Eigen doel</button>
    </div>

    <div class="form-grid">
      <div class="form-group full">
        <label>Doel</label>
        <input type="text" id="goal" value="Navy SEALs (BUD/S selectie)" placeholder="Bijv. Navy SEALs BUD/S, Marathon sub-3, Politieselectie...">
      </div>
      <div class="form-group">
        <label>Huidig fitnessniveau</label>
        <select id="fitness-level">
          <option value="Beginner">Beginner — Weinig sportachtergrond</option>
          <option value="Recreatief">Recreatief — 2-3x per week sport</option>
          <option value="Getraind" selected>Getraind — Regelmatig, structureel</option>
          <option value="Atletisch">Atletisch — Competitieve achtergrond</option>
          <option value="Elite">Elite — Topsportniveau</option>
        </select>
      </div>
      <div class="form-group">
        <label>Beschikbare tijd</label>
        <select id="time-available">
          <option value="3 maanden">3 maanden</option>
          <option value="6 maanden" selected>6 maanden</option>
          <option value="12 maanden">12 maanden</option>
          <option value="18+ maanden">18+ maanden</option>
        </select>
      </div>
      <div class="form-group">
        <label>Trainingsuren per week</label>
        <select id="hours-per-week">
          <option value="5-7 uur">5-7 uur</option>
          <option value="8-12 uur" selected>8-12 uur</option>
          <option value="13-16 uur">13-16 uur</option>
          <option value="17+ uur">17+ uur</option>
        </select>
      </div>
      <div class="form-group">
        <label>Leeftijd</label>
        <input type="number" id="age" placeholder="23" min="16" max="60">
      </div>
      <div class="form-group full">
        <label>Huidige prestaties / context (optioneel)</label>
        <textarea id="context" placeholder="Bijv: Ik loop momenteel 5km in 22 min, doe 15 pull-ups, heb een blessure gehad aan mijn linkerknie in 2023..."></textarea>
      </div>
    </div>

    <button class="submit-btn" id="generate-btn" onclick="generatePlan()">
      <span class="btn-text">Genereer trainingsplan</span>
      <span class="btn-loading">Plan wordt gegenereerd...</span>
    </button>
  </div>

  <div id="output-section">
    <div class="divider" data-label="Trainingsplan"></div>
    <div class="plan-header">
      <div>
        <div class="section-label">Gegenereerd plan</div>
        <div class="plan-title" id="plan-title">—</div>
      </div>
      <div class="plan-meta">
        <span>Tijdshorizon</span>
        <strong id="plan-duration">—</strong>
        <span style="margin-top:12px">Niveau</span>
        <strong id="plan-level">—</strong>
      </div>
    </div>
    <div id="stats-container"></div>
    <div id="plan-content"></div>
  </div>
</main>

<script>
  function setPreset(btn, value) {
    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('goal').value = value;
    if (!value) document.getElementById('goal').focus();
  }

  function renderMarkdown(text) {
    const escaped = text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');

    const lines = escaped.split('\n');
    let html = '';
    let inUl = false, inOl = false, inTable = false;

    for (let i = 0; i < lines.length; i++) {
      let line = lines[i];

      // Bold
      line = line.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      // Italic
      line = line.replace(/\*(.+?)\*/g, '<em>$1</em>');

      if (/^## (.+)/.test(line)) {
        if (inUl) { html += '</ul>'; inUl = false; }
        if (inOl) { html += '</ol>'; inOl = false; }
        if (inTable) { html += '</tbody></table>'; inTable = false; }
        html += `<h2>${line.replace(/^## /, '')}</h2>`;
      } else if (/^### (.+)/.test(line)) {
        html += `<h3>${line.replace(/^### /, '')}</h3>`;
      } else if (/^# (.+)/.test(line)) {
        html += `<h2>${line.replace(/^# /, '')}</h2>`;
      } else if (/^\|/.test(line) && /\|$/.test(line)) {
        if (!inTable) { html += '<table><tbody>'; inTable = true; }
        if (/^[\|\s\-:]+$/.test(line)) continue;
        const cells = line.split('|').filter((_, i, a) => i > 0 && i < a.length - 1).map(c => c.trim());
        const isHeader = i === 0 || !/^\|/.test(lines[i-1] || '');
        const tag = (inTable && i < 3) ? 'th' : 'td';
        html += `<tr>${cells.map(c => `<${tag}>${c}</${tag}>`).join('')}</tr>`;
      } else if (/^[-*] (.+)/.test(line)) {
        if (inTable) { html += '</tbody></table>'; inTable = false; }
        if (inOl) { html += '</ol>'; inOl = false; }
        if (!inUl) { html += '<ul>'; inUl = true; }
        html += `<li>${line.replace(/^[-*] /, '')}</li>`;
      } else if (/^\d+\. (.+)/.test(line)) {
        if (inTable) { html += '</tbody></table>'; inTable = false; }
        if (inUl) { html += '</ul>'; inUl = false; }
        if (!inOl) { html += '<ol>'; inOl = true; }
        html += `<li>${line.replace(/^\d+\. /, '')}</li>`;
      } else {
        if (inUl) { html += '</ul>'; inUl = false; }
        if (inOl) { html += '</ol>'; inOl = false; }
        if (inTable) { html += '</tbody></table>'; inTable = false; }
        if (line.trim()) html += `<p>${line}</p>`;
      }
    }

    if (inUl) html += '</ul>';
    if (inOl) html += '</ol>';
    if (inTable) html += '</tbody></table>';

    return html;
  }

  async function generatePlan() {
    const goal = document.getElementById('goal').value.trim();
    if (!goal) { alert('Vul een doel in.'); return; }

    const level = document.getElementById('fitness-level').value;
    const timeAvailable = document.getElementById('time-available').value;
    const hoursPerWeek = document.getElementById('hours-per-week').value;
    const age = document.getElementById('age').value;
    const context = document.getElementById('context').value.trim();

    const btn = document.getElementById('generate-btn');
    btn.classList.add('loading');
    btn.disabled = true;

    const outputSection = document.getElementById('output-section');
    outputSection.classList.add('visible');
    document.getElementById('plan-title').textContent = goal.toUpperCase();
    document.getElementById('plan-duration').textContent = timeAvailable;
    document.getElementById('plan-level').textContent = level;

    const contentEl = document.getElementById('plan-content');
    contentEl.innerHTML = `
      <div class="loading-state">
        <div class="loading-dots">
          <span></span><span></span><span></span>
        </div>
        Plan wordt gegenereerd
      </div>`;
    outputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

    const prompt = `Je bent een elite performance coach en militaire fitnesskonsultant.

Genereer een gedetailleerd, gefaseerd trainingsplan voor:

Doel: ${goal}
Huidig niveau: ${level}
Beschikbare tijd: ${timeAvailable}
Trainingsuren per week: ${hoursPerWeek}
${age ? `Leeftijd: ${age}` : ''}
${context ? `Context: ${context}` : ''}

Gebruik ## voor hoofdsecties en ### voor subsecties. Structuur:

## Overzicht
Korte samenvatting van doel, strategie en wat de atleet kan verwachten.

## Vereisten & Normen
Exacte fysieke en mentale normen. Gebruik tabellen waar relevant.

## Fasering
Logische fasen (Fase 1: Fundering, etc.). Per fase: duur, focus, wekelijks volume, kernoefeningen.

## Wekelijkse trainingsstructuur
Concreet weekschema dag voor dag. Specifiek in sets, reps, afstanden, tijden.

## Kernoefeningen & Progressie
De 5-8 meest kritische oefeningen met progressieschema.

## Herstel & Periodisatie
Herstelstructuur, deload-weken, slaap- en voedingsrichtlijnen.

## Kritische aandachtspunten
De 3-5 meest gemaakte fouten en hoe ze te vermijden.

## Testmomenten & Voortgang meten
Hoe je elke 4-6 weken voortgang evalueert.

Schrijf concreet en direct. Geen overbodige aanmoedigingen of clichés.`;

    try {
      const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          messages: [{ role: 'user', content: prompt }]
        })
      });

      if (!response.ok) {
        const err = await response.json().catch(() => ({}));
        throw new Error(err.error?.message || `Serverfout ${response.status}`);
      }

      const data = await response.json();
      const text = data.content?.[0]?.text || '';

      if (!text) throw new Error('Leeg antwoord ontvangen van de API.');

      contentEl.innerHTML = renderMarkdown(text);
      buildStatsBar(timeAvailable, hoursPerWeek);

    } catch (err) {
      contentEl.innerHTML = `<div class="error-msg"><strong>Fout:</strong> ${err.message}</div>`;
    }

    btn.classList.remove('loading');
    btn.disabled = false;
  }

  function buildStatsBar(duration, hours) {
    const container = document.getElementById('stats-container');
    const weeklyMin = parseInt(hours);
    const months = parseInt(duration);
    const totalWeeks = isNaN(months) ? '—' : months * 4;
    const totalHours = isNaN(months) || isNaN(weeklyMin) ? '—' : `~${weeklyMin * months * 4}`;

    container.innerHTML = `
      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-label">Tijdshorizon</span>
          <span class="stat-value">${duration}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Uren / week</span>
          <span class="stat-value">${hours}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Totale weken</span>
          <span class="stat-value">${totalWeeks}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Investering</span>
          <span class="stat-value">${totalHours}u</span>
        </div>
      </div>`;
  }
</script>
</body>
</html>
