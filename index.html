<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GROUNDWORK</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;900&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg: #0a0a0a; --surface: #111; --surface2: #1a1a1a; --surface3: #222;
    --border: #222; --border2: #2e2e2e;
    --text: #e8e4dc; --muted: #666; --muted2: #444;
    --accent: #c8a96e; --accent-dim: #8a7148; --accent-bg: rgba(200,169,110,0.07);
    --danger: #b34444; --green: #4a7c59; --blue: #4a6b8a;
    --mono: 'Courier New', monospace;
  }
  html { scroll-behavior: smooth; }
  body { background: var(--bg); color: var(--text); font-family: 'Barlow', sans-serif; font-weight: 300; min-height: 100vh; }

  /* LAYOUT */
  .app { display: grid; grid-template-columns: 220px 1fr; min-height: 100vh; }

  /* SIDEBAR */
  .sidebar {
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex; flex-direction: column;
    position: sticky; top: 0; height: 100vh;
    overflow-y: auto;
  }
  .sidebar-logo {
    padding: 28px 24px 20px;
    border-bottom: 1px solid var(--border);
  }
  .logo { font-family: 'Barlow Condensed', sans-serif; font-weight: 900; font-size: 18px; letter-spacing: 0.2em; text-transform: uppercase; }
  .logo-sub { font-size: 10px; letter-spacing: 0.15em; color: var(--muted); text-transform: uppercase; margin-top: 2px; }

  .nav { padding: 16px 0; flex: 1; }
  .nav-section { padding: 12px 24px 4px; font-size: 10px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted2); }
  .nav-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 24px; font-size: 13px; color: var(--muted);
    cursor: pointer; transition: all 0.15s; border-left: 2px solid transparent;
    letter-spacing: 0.02em;
  }
  .nav-item:hover { color: var(--text); background: var(--surface2); }
  .nav-item.active { color: var(--accent); border-left-color: var(--accent); background: var(--accent-bg); }
  .nav-icon { font-size: 14px; width: 16px; text-align: center; }

  /* MAIN */
  .main { overflow-y: auto; }
  .page { display: none; padding: 40px 48px 80px; max-width: 960px; }
  .page.active { display: block; }

  /* SETUP OVERLAY */
  .setup-overlay {
    position: fixed; inset: 0; background: var(--bg);
    display: flex; align-items: center; justify-content: center;
    z-index: 999; padding: 40px;
  }
  .setup-box { max-width: 520px; width: 100%; }
  .setup-box h2 { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 32px; text-transform: uppercase; margin-bottom: 8px; }
  .setup-box p { color: var(--muted); font-size: 13px; line-height: 1.7; margin-bottom: 32px; }
  .setup-step { display: none; }
  .setup-step.active { display: block; }

  /* TYPOGRAPHY */
  .page-title { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 36px; text-transform: uppercase; letter-spacing: -0.01em; margin-bottom: 4px; }
  .page-sub { color: var(--muted); font-size: 13px; margin-bottom: 40px; }
  .section-label {
    font-family: 'Barlow Condensed', sans-serif; font-size: 11px;
    letter-spacing: 0.25em; text-transform: uppercase; color: var(--accent);
    margin-bottom: 16px; display: flex; align-items: center; gap: 12px;
  }
  .section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  /* CARDS */
  .card { background: var(--surface); border: 1px solid var(--border); padding: 24px; margin-bottom: 16px; }
  .card-title { font-family: 'Barlow Condensed', sans-serif; font-weight: 600; font-size: 14px; letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted); margin-bottom: 16px; }

  /* GRID */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
  .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px; background: var(--border); margin-bottom: 32px; }
  .stat-box { background: var(--surface); padding: 20px; }
  .stat-val { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 28px; color: var(--accent); }
  .stat-lbl { font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin-top: 2px; }

  /* FORMS */
  .form-group { display: flex; flex-direction: column; gap: 6px; margin-bottom: 16px; }
  label { font-size: 11px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); font-weight: 500; }
  input, select, textarea {
    background: var(--surface2); border: 1px solid var(--border2); color: var(--text);
    padding: 11px 14px; font-family: 'Barlow', sans-serif; font-size: 13px;
    outline: none; transition: border-color 0.15s; width: 100%;
  }
  input:focus, select:focus, textarea:focus { border-color: var(--accent-dim); }
  select { appearance: none; cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23666' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px;
  }
  select option { background: #111; }
  textarea { resize: vertical; min-height: 80px; line-height: 1.6; }

  /* RANGE SLIDERS */
  .slider-group { display: flex; flex-direction: column; gap: 6px; margin-bottom: 16px; }
  .slider-header { display: flex; justify-content: space-between; align-items: center; }
  .slider-label { font-size: 11px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); }
  .slider-val { font-family: 'Barlow Condensed', sans-serif; font-size: 18px; font-weight: 700; color: var(--accent); }
  input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; height: 2px; background: var(--border2); outline: none; }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: var(--accent); cursor: pointer; border-radius: 50%; }

  /* BUTTONS */
  .btn { padding: 12px 24px; font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 13px; letter-spacing: 0.15em; text-transform: uppercase; cursor: pointer; transition: all 0.15s; border: none; }
  .btn-primary { background: var(--accent); color: #0a0a0a; }
  .btn-primary:hover { background: #d4b87c; }
  .btn-secondary { background: transparent; color: var(--muted); border: 1px solid var(--border2); }
  .btn-secondary:hover { color: var(--text); border-color: var(--muted); }
  .btn-danger { background: transparent; color: var(--danger); border: 1px solid var(--danger); }
  .btn-full { width: 100%; }

  /* TABS */
  .tabs { display: flex; border-bottom: 1px solid var(--border); margin-bottom: 32px; }
  .tab { padding: 12px 20px; font-family: 'Barlow Condensed', sans-serif; font-size: 12px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; }
  .tab:hover { color: var(--text); }
  .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* LOG LIST */
  .log-item { border-bottom: 1px solid var(--border); padding: 16px 0; display: grid; grid-template-columns: 80px 1fr auto; gap: 16px; align-items: start; }
  .log-date { font-family: var(--mono); font-size: 11px; color: var(--muted); padding-top: 2px; }
  .log-title { font-size: 14px; font-weight: 500; margin-bottom: 4px; }
  .log-meta { font-size: 12px; color: var(--muted); }
  .log-badge { font-family: 'Barlow Condensed', sans-serif; font-size: 11px; letter-spacing: 0.1em; text-transform: uppercase; padding: 3px 8px; border: 1px solid var(--border2); color: var(--muted); }

  /* PLAN DISPLAY */
  .plan-text h2 { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; font-size: 18px; letter-spacing: 0.1em; text-transform: uppercase; color: var(--accent); margin: 32px 0 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
  .plan-text h2:first-child { margin-top: 0; }
  .plan-text h3 { font-family: 'Barlow Condensed', sans-serif; font-size: 14px; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text); margin: 20px 0 8px; }
  .plan-text p { font-size: 13px; color: #c4bfb4; line-height: 1.8; margin-bottom: 12px; }
  .plan-text ul, .plan-text ol { list-style: none; padding: 0; margin-bottom: 16px; }
  .plan-text li { font-size: 13px; color: #c4bfb4; padding: 6px 0 6px 20px; position: relative; border-bottom: 1px solid var(--border); }
  .plan-text ul li::before { content: '—'; position: absolute; left: 0; color: var(--accent-dim); }
  .plan-text ol { counter-reset: s; }
  .plan-text ol li { counter-increment: s; }
  .plan-text ol li::before { content: counter(s, decimal-leading-zero); position: absolute; left: 0; color: var(--accent-dim); font-family: var(--mono); font-size: 10px; top: 8px; }
  .plan-text strong { color: var(--text); font-weight: 600; }
  .plan-text table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 12px; }
  .plan-text th { font-family: 'Barlow Condensed', sans-serif; font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--border); }
  .plan-text td { padding: 10px 12px; border-bottom: 1px solid var(--border); color: #c4bfb4; }

  /* WELLBEING INDICATORS */
  .indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
  .ind-green { background: #4a7c59; }
  .ind-orange { background: #c8883a; }
  .ind-red { background: #b34444; }

  /* CHART */
  .chart-wrap { position: relative; height: 200px; margin-bottom: 8px; }

  /* EMPTY STATE */
  .empty { text-align: center; padding: 60px 20px; color: var(--muted); }
  .empty-icon { font-size: 32px; margin-bottom: 12px; opacity: 0.3; }
  .empty p { font-size: 13px; line-height: 1.6; }

  /* TOAST */
  .toast { position: fixed; bottom: 24px; right: 24px; background: var(--surface); border: 1px solid var(--border2); padding: 14px 20px; font-size: 13px; z-index: 9999; transform: translateY(80px); opacity: 0; transition: all 0.25s; }
  .toast.show { transform: translateY(0); opacity: 1; }
  .toast.success { border-color: var(--green); color: #7ab88f; }
  .toast.error { border-color: var(--danger); color: #d47474; }

  /* PRESETS */
  .preset-row { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
  .preset { padding: 6px 12px; border: 1px solid var(--border2); background: transparent; color: var(--muted); font-family: 'Barlow Condensed', sans-serif; font-size: 11px; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.15s; }
  .preset:hover, .preset.active { border-color: var(--accent-dim); color: var(--accent); background: var(--accent-bg); }

  /* MOBILE */
  .mobile-nav { display: none; }
  @media (max-width: 768px) {
    .app { grid-template-columns: 1fr; }
    .sidebar { display: none; }
    .page { padding: 24px 20px 100px; }
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
    .grid-4 { grid-template-columns: 1fr 1fr; }
    .mobile-nav { display: flex; position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface); border-top: 1px solid var(--border); z-index: 100; }
    .mobile-nav-item { flex: 1; padding: 12px 8px; text-align: center; cursor: pointer; font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted); transition: color 0.15s; }
    .mobile-nav-item.active { color: var(--accent); }
    .mobile-nav-icon { font-size: 18px; display: block; margin-bottom: 2px; }
    .log-item { grid-template-columns: 1fr auto; }
    .log-date { display: none; }
  }
</style>
</head>
<body>

<!-- AUTH OVERLAY -->
<div class="setup-overlay" id="authOverlay" style="display:none">
  <div class="setup-box">
    <div style="font-family:'Barlow Condensed',sans-serif;font-size:11px;letter-spacing:0.2em;text-transform:uppercase;color:var(--accent);margin-bottom:16px" id="auth-mode-label">Inloggen</div>
    <h2 id="auth-title">Welkom<br>terug</h2>
    <p id="auth-sub" style="color:var(--muted);font-size:13px;line-height:1.7;margin-bottom:32px">Log in om verder te gaan.</p>
    <div class="form-group"><label>E-mailadres</label><input type="email" id="auth-email" placeholder="jij@voorbeeld.com"></div>
    <div class="form-group" style="margin-bottom:24px"><label>Wachtwoord</label><input type="password" id="auth-password" placeholder="••••••••"></div>
    <div id="auth-error" style="display:none;color:#d47474;font-size:12px;margin-bottom:16px;padding:10px 14px;border:1px solid var(--danger);background:rgba(179,68,68,0.08)"></div>
    <button class="btn btn-primary btn-full" onclick="authSubmit()" id="auth-submit-btn">Inloggen</button>
    <div style="margin-top:16px;text-align:center;font-size:12px;color:var(--muted)">
      <span id="auth-switch-text">Nog geen account?</span>
      <span style="color:var(--accent);cursor:pointer;margin-left:4px" onclick="toggleAuthMode()" id="auth-switch-link">Registreren</span>
    </div>
  </div>
</div>

<!-- APP -->
<div class="app" id="appShell" style="display:none">
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo">Groundwork</div>
      <div class="logo-sub">Performance System</div>
    </div>
    <nav class="nav">
      <div class="nav-section">Overzicht</div>
      <div class="nav-item active" onclick="showPage('dashboard')"><span class="nav-icon">▣</span> Dashboard</div>
      <div class="nav-item" onclick="showPage('plan')"><span class="nav-icon">◈</span> Trainingsplan</div>
      <div class="nav-section">Logboek</div>
      <div class="nav-item" onclick="showPage('training')"><span class="nav-icon">◉</span> Training loggen</div>
      <div class="nav-item" onclick="showPage('wellbeing')"><span class="nav-icon">◎</span> Welzijn</div>
      <div class="nav-item" onclick="showPage('injuries')"><span class="nav-icon">◌</span> Blessures</div>
      <div class="nav-item" onclick="showPage('tests')"><span class="nav-icon">◆</span> Testresultaten</div>
      <div class="nav-section">Analyse</div>
      <div class="nav-item" onclick="showPage('progress')"><span class="nav-icon">◐</span> Voortgang</div>
      <div style="flex:1"></div>
      <div class="nav-item" onclick="logout()" style="margin-bottom:12px;color:var(--muted)"><span class="nav-icon">◁</span> Uitloggen</div>
    </nav>
  </aside>

  <main class="main">

    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
      <div class="page-title">Dashboard</div>
      <div class="page-sub" id="dash-date">—</div>

      <div class="grid-4" id="dash-stats">
        <div class="stat-box"><div class="stat-val" id="ds-trainingen">—</div><div class="stat-lbl">Trainingen</div></div>
        <div class="stat-box"><div class="stat-val" id="ds-streak">—</div><div class="stat-lbl">Dagen streak</div></div>
        <div class="stat-box"><div class="stat-val" id="ds-slaap">—</div><div class="stat-lbl">Gem. slaap</div></div>
        <div class="stat-box"><div class="stat-val" id="ds-welzijn">—</div><div class="stat-lbl">Gem. welzijn</div></div>
      </div>

      <div class="grid-2">
        <div>
          <div class="section-label">Recente trainingen</div>
          <div id="dash-recent-trainingen"><div class="empty"><div class="empty-icon">◎</div><p>Nog geen trainingen gelogd.</p></div></div>
          <button class="btn btn-secondary" style="margin-top:12px;width:100%" onclick="showPage('training')">Training toevoegen</button>
        </div>
        <div>
          <div class="section-label">Welzijn vandaag</div>
          <div id="dash-welzijn-status"></div>
          <button class="btn btn-secondary" style="margin-top:12px;width:100%" onclick="showPage('wellbeing')">Welzijn loggen</button>
        </div>
      </div>
    </div>

    <!-- PLAN -->
    <div class="page" id="page-plan">
      <div class="page-title">Trainingsplan</div>
      <div class="page-sub">Genereer of bekijk je actieve plan</div>

      <div id="plan-display" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
          <div>
            <div style="font-family:'Barlow Condensed',sans-serif;font-size:11px;letter-spacing:0.2em;text-transform:uppercase;color:var(--accent);margin-bottom:4px">Actief plan</div>
            <div style="font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:28px;text-transform:uppercase" id="plan-goal-title">—</div>
          </div>
          <button class="btn btn-secondary" onclick="showPlanGenerator()">Nieuw plan</button>
        </div>
        <div class="plan-text" id="plan-content-display"></div>
      </div>

      <div id="plan-generator">
        <div class="section-label">Nieuw plan genereren</div>
        <div class="preset-row">
          <button class="preset active" onclick="setPlanPreset(this,'Navy SEALs (BUD/S selectie)')">Navy SEALs</button>
          <button class="preset" onclick="setPlanPreset(this,'Marine Corps OCS')">Marine Corps</button>
          <button class="preset" onclick="setPlanPreset(this,'Politie / Defensie fitness test')">Politie / Defensie</button>
          <button class="preset" onclick="setPlanPreset(this,'Marathon sub 3 uur')">Marathon sub-3</button>
          <button class="preset" onclick="setPlanPreset(this,'Ironman triathlon')">Ironman</button>
          <button class="preset" onclick="setPlanPreset(this,'')">Eigen doel</button>
        </div>
        <div class="grid-2">
          <div class="form-group" style="grid-column:1/-1">
            <label>Doel</label>
            <input type="text" id="plan-goal" value="Navy SEALs (BUD/S selectie)">
          </div>
          <div class="form-group">
            <label>Fitnessniveau</label>
            <select id="plan-level">
              <option value="Beginner">Beginner</option>
              <option value="Recreatief">Recreatief</option>
              <option value="Getraind" selected>Getraind</option>
              <option value="Atletisch">Atletisch</option>
              <option value="Elite">Elite</option>
            </select>
          </div>
          <div class="form-group">
            <label>Beschikbare tijd</label>
            <select id="plan-time">
              <option value="3 maanden">3 maanden</option>
              <option value="6 maanden" selected>6 maanden</option>
              <option value="12 maanden">12 maanden</option>
              <option value="18+ maanden">18+ maanden</option>
            </select>
          </div>
          <div class="form-group">
            <label>Trainingsuren per week</label>
            <select id="plan-hours">
              <option value="5-7 uur">5-7 uur</option>
              <option value="8-12 uur" selected>8-12 uur</option>
              <option value="13-16 uur">13-16 uur</option>
              <option value="17+ uur">17+ uur</option>
            </select>
          </div>
          <div class="form-group">
            <label>Leeftijd</label>
            <input type="number" id="plan-age" placeholder="23">
          </div>
          <div class="form-group" style="grid-column:1/-1">
            <label>Huidige prestaties / context</label>
            <textarea id="plan-context" placeholder="Bijv: 5km in 22 min, 15 pull-ups..."></textarea>
          </div>
        </div>
        <button class="btn btn-primary btn-full" id="plan-btn" onclick="generatePlan()">
          <span id="plan-btn-text">Genereer plan</span>
        </button>
        <div id="plan-loading" style="display:none;padding:32px 0;text-align:center;color:var(--muted);font-size:13px">Plan wordt gegenereerd...</div>
      </div>
    </div>

    <!-- TRAINING LOG -->
    <div class="page" id="page-training">
      <div class="page-title">Training loggen</div>
      <div class="page-sub">Leg je sessie vast</div>

      <div class="tabs">
        <div class="tab active" onclick="switchTab('training','log')">Nieuwe sessie</div>
        <div class="tab" onclick="switchTab('training','history')">Historie</div>
      </div>

      <div class="tab-content active" id="training-tab-log">
        <div class="grid-2">
          <div class="form-group">
            <label>Type training</label>
            <select id="t-type">
              <option value="zwemmen">Zwemmen</option>
              <option value="hardlopen" selected>Hardlopen</option>
              <option value="krachttraining">Krachttraining</option>
              <option value="ruck">Ruck / mars</option>
              <option value="calisthenics">Calisthenics</option>
              <option value="overig">Overig</option>
            </select>
          </div>
          <div class="form-group">
            <label>Datum</label>
            <input type="date" id="t-date">
          </div>
          <div class="form-group">
            <label>Duur (minuten)</label>
            <input type="number" id="t-duration" placeholder="60">
          </div>
          <div class="form-group">
            <label>Afstand (km) — optioneel</label>
            <input type="number" id="t-distance" placeholder="10" step="0.1">
          </div>
        </div>

        <div class="slider-group">
          <div class="slider-header">
            <div class="slider-label">Inspanning (RPE 1-10)</div>
            <div class="slider-val" id="t-rpe-val">7</div>
          </div>
          <input type="range" min="1" max="10" value="7" id="t-rpe" oninput="document.getElementById('t-rpe-val').textContent=this.value">
        </div>

        <div class="form-group">
          <label>Oefeningen / sets / reps (optioneel)</label>
          <textarea id="t-exercises" placeholder="Bijv:&#10;Pull-ups: 4x12&#10;Push-ups: 4x25&#10;Plank: 3x60sec"></textarea>
        </div>
        <div class="form-group">
          <label>Notities</label>
          <textarea id="t-notes" placeholder="Hoe voelde de sessie? Bijzonderheden?"></textarea>
        </div>
        <button class="btn btn-primary btn-full" onclick="saveTraining()">Opslaan</button>
      </div>

      <div class="tab-content" id="training-tab-history">
        <div id="training-history-list"><div class="empty"><div class="empty-icon">◎</div><p>Nog geen trainingen gelogd.</p></div></div>
      </div>
    </div>

    <!-- WELLBEING -->
    <div class="page" id="page-wellbeing">
      <div class="page-title">Welzijn</div>
      <div class="page-sub">Dagelijkse check-in</div>

      <div class="tabs">
        <div class="tab active" onclick="switchTab('wellbeing','log')">Vandaag</div>
        <div class="tab" onclick="switchTab('wellbeing','history')">Historie</div>
      </div>

      <div class="tab-content active" id="wellbeing-tab-log">
        <div class="form-group">
          <label>Datum</label>
          <input type="date" id="w-date">
        </div>

        <div class="slider-group">
          <div class="slider-header"><div class="slider-label">Slaap (uren)</div><div class="slider-val" id="w-sleep-val">7.5</div></div>
          <input type="range" min="3" max="12" step="0.5" value="7.5" id="w-sleep" oninput="document.getElementById('w-sleep-val').textContent=this.value">
        </div>
        <div class="slider-group">
          <div class="slider-header"><div class="slider-label">Slaapkwaliteit (1-10)</div><div class="slider-val" id="w-sleepq-val">7</div></div>
          <input type="range" min="1" max="10" value="7" id="w-sleepq" oninput="document.getElementById('w-sleepq-val').textContent=this.value">
        </div>
        <div class="slider-group">
          <div class="slider-header"><div class="slider-label">Vermoeidheid (1-10)</div><div class="slider-val" id="w-fatigue-val">4</div></div>
          <input type="range" min="1" max="10" value="4" id="w-fatigue" oninput="document.getElementById('w-fatigue-val').textContent=this.value">
        </div>
        <div class="slider-group">
          <div class="slider-header"><div class="slider-label">Stress (1-10)</div><div class="slider-val" id="w-stress-val">3</div></div>
          <input type="range" min="1" max="10" value="3" id="w-stress" oninput="document.getElementById('w-stress-val').textContent=this.value">
        </div>
        <div class="slider-group">
          <div class="slider-header"><div class="slider-label">Spierpijn (1-10)</div><div class="slider-val" id="w-soreness-val">3</div></div>
          <input type="range" min="1" max="10" value="3" id="w-soreness" oninput="document.getElementById('w-soreness-val').textContent=this.value">
        </div>
        <div class="form-group">
          <label>Notities</label>
          <textarea id="w-notes" placeholder="Hoe voel je je vandaag?"></textarea>
        </div>
        <button class="btn btn-primary btn-full" onclick="saveWellbeing()">Opslaan</button>
      </div>

      <div class="tab-content" id="wellbeing-tab-history">
        <div id="wellbeing-history-list"><div class="empty"><div class="empty-icon">◎</div><p>Nog geen welzijn gelogd.</p></div></div>
      </div>
    </div>

    <!-- INJURIES -->
    <div class="page" id="page-injuries">
      <div class="page-title">Blessures</div>
      <div class="page-sub">Pijn- en blessureregistratie</div>

      <div class="tabs">
        <div class="tab active" onclick="switchTab('injuries','log')">Registreren</div>
        <div class="tab" onclick="switchTab('injuries','history')">Overzicht</div>
      </div>

      <div class="tab-content active" id="injuries-tab-log">
        <div class="grid-2">
          <div class="form-group">
            <label>Lichaamsdeel</label>
            <select id="inj-part">
              <option value="linker knie">Linker knie</option>
              <option value="rechter knie">Rechter knie</option>
              <option value="linker enkel">Linker enkel</option>
              <option value="rechter enkel">Rechter enkel</option>
              <option value="onderrug">Onderrug</option>
              <option value="bovenrug">Bovenrug</option>
              <option value="linker schouder">Linker schouder</option>
              <option value="rechter schouder">Rechter schouder</option>
              <option value="nek">Nek</option>
              <option value="linker heup">Linker heup</option>
              <option value="rechter heup">Rechter heup</option>
              <option value="scheenbeen links">Scheenbeen links</option>
              <option value="scheenbeen rechts">Scheenbeen rechts</option>
              <option value="overig">Overig</option>
            </select>
          </div>
          <div class="form-group">
            <label>Type</label>
            <select id="inj-type">
              <option value="acuut">Acuut</option>
              <option value="chronisch">Chronisch / sluipend</option>
              <option value="overbelasting">Overbelasting</option>
            </select>
          </div>
          <div class="form-group">
            <label>Datum</label>
            <input type="date" id="inj-date">
          </div>
        </div>
        <div class="slider-group">
          <div class="slider-header"><div class="slider-label">Pijnscore (0-10)</div><div class="slider-val" id="inj-pain-val">4</div></div>
          <input type="range" min="0" max="10" value="4" id="inj-pain" oninput="document.getElementById('inj-pain-val').textContent=this.value">
        </div>
        <div class="form-group">
          <label>Beschrijving</label>
          <textarea id="inj-notes" placeholder="Wanneer doet het pijn? Bij welke bewegingen?"></textarea>
        </div>
        <button class="btn btn-primary btn-full" onclick="saveInjury()">Registreren</button>
      </div>

      <div class="tab-content" id="injuries-tab-history">
        <div id="injuries-history-list"><div class="empty"><div class="empty-icon">◌</div><p>Geen blessures geregistreerd.</p></div></div>
      </div>
    </div>

    <!-- TESTS -->
    <div class="page" id="page-tests">
      <div class="page-title">Testresultaten</div>
      <div class="page-sub">PST en prestatietests</div>

      <div class="tabs">
        <div class="tab active" onclick="switchTab('tests','log')">Resultaat invoeren</div>
        <div class="tab" onclick="switchTab('tests','history')">Historie</div>
      </div>

      <div class="tab-content active" id="tests-tab-log">
        <div class="form-group">
          <label>Datum</label>
          <input type="date" id="tst-date">
        </div>
        <div class="section-label" style="margin-top:8px">PST — Navy SEAL</div>
        <div class="grid-2">
          <div class="form-group">
            <label>500m zwemmen (mm:ss)</label>
            <input type="text" id="tst-swim" placeholder="12:30">
          </div>
          <div class="form-group">
            <label>Pull-ups (max)</label>
            <input type="number" id="tst-pullups" placeholder="15">
          </div>
          <div class="form-group">
            <label>Push-ups in 2 min</label>
            <input type="number" id="tst-pushups" placeholder="80">
          </div>
          <div class="form-group">
            <label>Sit-ups in 2 min</label>
            <input type="number" id="tst-situps" placeholder="80">
          </div>
          <div class="form-group">
            <label>1.5 mijl lopen (mm:ss)</label>
            <input type="text" id="tst-run15" placeholder="09:30">
          </div>
          <div class="form-group">
            <label>5 mijl lopen (mm:ss)</label>
            <input type="text" id="tst-run5" placeholder="42:00">
          </div>
        </div>
        <div class="section-label">Overige prestaties</div>
        <div class="form-group">
          <label>Vrij veld (bijv. 400m sprint: 62sec, Deadlift: 140kg)</label>
          <textarea id="tst-custom" placeholder="Voer hier andere testresultaten in..."></textarea>
        </div>
        <button class="btn btn-primary btn-full" onclick="saveTest()">Opslaan</button>
      </div>

      <div class="tab-content" id="tests-tab-history">
        <div id="tests-history-list"><div class="empty"><div class="empty-icon">◆</div><p>Geen testresultaten gelogd.</p></div></div>
      </div>
    </div>

    <!-- PROGRESS -->
    <div class="page" id="page-progress">
      <div class="page-title">Voortgang</div>
      <div class="page-sub">Grafieken en analyse</div>

      <div class="section-label">Trainingsvolume (laatste 30 dagen)</div>
      <div class="card">
        <div class="chart-wrap"><canvas id="chart-volume"></canvas></div>
      </div>

      <div class="section-label">Welzijn (laatste 30 dagen)</div>
      <div class="card">
        <div class="chart-wrap"><canvas id="chart-wellbeing"></canvas></div>
      </div>

      <div class="section-label">PST Progressie</div>
      <div class="card" id="pst-progress-card">
        <div class="empty"><div class="empty-icon">◆</div><p>Voer minimaal 2 testresultaten in om progressie te zien.</p></div>
      </div>
    </div>

  </main>
</div>

<!-- MOBILE NAV -->
<div class="mobile-nav">
  <div class="mobile-nav-item active" onclick="showPage('dashboard')"><span class="mobile-nav-icon">▣</span>Dashboard</div>
  <div class="mobile-nav-item" onclick="showPage('training')"><span class="mobile-nav-icon">◉</span>Training</div>
  <div class="mobile-nav-item" onclick="showPage('wellbeing')"><span class="mobile-nav-icon">◎</span>Welzijn</div>
  <div class="mobile-nav-item" onclick="showPage('tests')"><span class="mobile-nav-icon">◆</span>Tests</div>
  <div class="mobile-nav-item" onclick="showPage('progress')"><span class="mobile-nav-icon">◐</span>Voortgang</div>
</div>

<div class="toast" id="toast"></div>

<script>
let sb = null;
let authMode = 'login';

// Init — fetch Supabase config from server
document.addEventListener('DOMContentLoaded', async () => {
  const today = new Date().toISOString().split('T')[0];
  ['t-date','w-date','inj-date','tst-date'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = today;
  });
  document.getElementById('dash-date').textContent = new Date().toLocaleDateString('nl-NL', {weekday:'long',year:'numeric',month:'long',day:'numeric'});

  try {
    const res = await fetch('/api/config');
    if (!res.ok) throw new Error('Config niet beschikbaar');
    const { url, key } = await res.json();
    sb = supabase.createClient(url, key);
    checkAuth();
  } catch(err) {
    document.getElementById('authOverlay').style.display = 'flex';
    document.getElementById('auth-error').textContent = 'Kan geen verbinding maken met de server. Probeer de pagina te vernieuwen.';
    document.getElementById('auth-error').style.display = 'block';
  }
});

function initSupabase(url, key) {
  sb = supabase.createClient(url, key);
}

async function checkAuth() {
  const { data: { session } } = await sb.auth.getSession();
  if (session) {
    showApp();
  } else {
    document.getElementById('authOverlay').style.display = 'flex';
  }
}

function toggleAuthMode() {
  authMode = authMode === 'login' ? 'register' : 'login';
  const isLogin = authMode === 'login';
  document.getElementById('auth-mode-label').textContent = isLogin ? 'Inloggen' : 'Registreren';
  document.getElementById('auth-title').innerHTML = isLogin ? 'Welkom<br>terug' : 'Account<br>aanmaken';
  document.getElementById('auth-sub').textContent = isLogin ? 'Log in om verder te gaan.' : 'Maak een account aan om te beginnen.';
  document.getElementById('auth-submit-btn').textContent = isLogin ? 'Inloggen' : 'Registreren';
  document.getElementById('auth-switch-text').textContent = isLogin ? 'Nog geen account?' : 'Al een account?';
  document.getElementById('auth-switch-link').textContent = isLogin ? 'Registreren' : 'Inloggen';
  document.getElementById('auth-error').style.display = 'none';
}

async function authSubmit() {
  const email = document.getElementById('auth-email').value.trim();
  const password = document.getElementById('auth-password').value;
  const errEl = document.getElementById('auth-error');
  errEl.style.display = 'none';

  if (!email || !password) { errEl.textContent = 'Vul e-mail en wachtwoord in.'; errEl.style.display = 'block'; return; }

  let result;
  if (authMode === 'login') {
    result = await sb.auth.signInWithPassword({ email, password });
  } else {
    result = await sb.auth.signUp({ email, password });
  }

  if (result.error) {
    errEl.textContent = result.error.message;
    errEl.style.display = 'block';
    return;
  }

  if (authMode === 'register' && !result.data.session) {
    errEl.style.color = '#7ab88f';
    errEl.textContent = 'Bevestig je e-mailadres via de mail die we hebben gestuurd.';
    errEl.style.display = 'block';
    return;
  }

  document.getElementById('authOverlay').style.display = 'none';
  showApp();
}

async function logout() {
  await sb.auth.signOut();
  document.getElementById('appShell').style.display = 'none';
  document.getElementById('authOverlay').style.display = 'flex';
  document.getElementById('auth-email').value = '';
  document.getElementById('auth-password').value = '';
  authMode = 'login';
}



function showApp() {
  document.getElementById('appShell').style.display = 'grid';
  loadDashboard();
  loadPlan();
}

// NAVIGATION
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.mobile-nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => { if (n.textContent.trim().toLowerCase().includes(name === 'dashboard' ? 'dashboard' : name === 'plan' ? 'plan' : name === 'training' ? 'training' : name === 'wellbeing' ? 'welzijn' : name === 'injuries' ? 'blessure' : name === 'tests' ? 'test' : name === 'progress' ? 'voortgang' : '')) n.classList.add('active'); });
  document.querySelectorAll('.mobile-nav-item').forEach(n => { if (n.textContent.toLowerCase().includes(name === 'dashboard' ? 'dashboard' : name === 'training' ? 'training' : name === 'wellbeing' ? 'welzijn' : name === 'tests' ? 'tests' : name === 'progress' ? 'voortgang' : '')) n.classList.add('active'); });

  if (name === 'training') loadTrainingHistory();
  if (name === 'wellbeing') loadWellbeingHistory();
  if (name === 'injuries') loadInjuriesHistory();
  if (name === 'tests') loadTestsHistory();
  if (name === 'progress') loadProgress();
}

function switchTab(page, tab) {
  const tabs = document.querySelectorAll(`#page-${page} .tab`);
  const contents = document.querySelectorAll(`#page-${page} .tab-content`);
  tabs.forEach((t,i) => { t.classList.toggle('active', i === (tab === 'log' ? 0 : 1)); });
  contents.forEach((c,i) => { c.classList.toggle('active', i === (tab === 'log' ? 0 : 1)); });
}

// TOAST
function showToast(msg, type = 'success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `toast ${type} show`;
  setTimeout(() => t.className = 'toast', 2500);
}

// MARKDOWN
function md(text) {
  const e = text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  const lines = e.split('\n');
  let html = '', inUl = false, inOl = false, inTbl = false;
  for (let line of lines) {
    line = line.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>');
    if (/^## (.+)/.test(line)) { close(); html += `<h2>${line.slice(3)}</h2>`; }
    else if (/^### (.+)/.test(line)) { html += `<h3>${line.slice(4)}</h3>`; }
    else if (/^# (.+)/.test(line)) { close(); html += `<h2>${line.slice(2)}</h2>`; }
    else if (/^\|/.test(line) && /\|$/.test(line)) {
      if (!inTbl) { html += '<table><tbody>'; inTbl = true; }
      if (/^[\|\s\-:]+$/.test(line)) continue;
      const cells = line.split('|').filter((_,i,a) => i>0 && i<a.length-1).map(c=>c.trim());
      html += `<tr>${cells.map(c=>`<td>${c}</td>`).join('')}</tr>`;
    } else if (/^[-*] (.+)/.test(line)) { if (!inUl){closeOl();closeTbl();html+='<ul>';inUl=true;} html+=`<li>${line.slice(2)}</li>`; }
    else if (/^\d+\. (.+)/.test(line)) { if (!inOl){closeUl();closeTbl();html+='<ol>';inOl=true;} html+=`<li>${line.replace(/^\d+\. /,'')}</li>`; }
    else { close(); if (line.trim()) html+=`<p>${line}</p>`; }
  }
  close();
  return html;
  function closeUl(){if(inUl){html+='</ul>';inUl=false;}}
  function closeOl(){if(inOl){html+='</ol>';inOl=false;}}
  function closeTbl(){if(inTbl){html+='</tbody></table>';inTbl=false;}}
  function close(){closeUl();closeOl();closeTbl();}
}

// PLAN
function setPlanPreset(btn, val) {
  document.querySelectorAll('.preset').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('plan-goal').value = val;
}

function showPlanGenerator() {
  document.getElementById('plan-display').style.display = 'none';
  document.getElementById('plan-generator').style.display = 'block';
}

async function loadPlan() {
  if (!sb) return;
  const { data } = await sb.from('plan').select('*').order('created_at', { ascending: false }).limit(1);
  if (data && data.length > 0) {
    document.getElementById('plan-display').style.display = 'block';
    document.getElementById('plan-generator').style.display = 'none';
    document.getElementById('plan-goal-title').textContent = data[0].doel;
    document.getElementById('plan-content-display').innerHTML = md(data[0].inhoud);
  }
}

async function generatePlan() {
  const goal = document.getElementById('plan-goal').value.trim();
  if (!goal) { showToast('Vul een doel in.', 'error'); return; }
  const level = document.getElementById('plan-level').value;
  const time = document.getElementById('plan-time').value;
  const hours = document.getElementById('plan-hours').value;
  const age = document.getElementById('plan-age').value;
  const context = document.getElementById('plan-context').value;

  document.getElementById('plan-btn').style.display = 'none';
  document.getElementById('plan-loading').style.display = 'block';

  const prompt = `Je bent een elite performance coach. Genereer een gedetailleerd trainingsplan voor:

Doel: ${goal}
Niveau: ${level}
Tijd: ${time}
Uren/week: ${hours}
${age ? `Leeftijd: ${age}` : ''}
${context ? `Context: ${context}` : ''}

Gebruik ## voor secties. Structuur:
## Overzicht
## Vereisten & Normen
## Fasering
## Wekelijkse trainingsstructuur
## Kernoefeningen & Progressie
## Herstel & Periodisatie
## Kritische aandachtspunten
## Testmomenten & Voortgang

Schrijf concreet, direct, zonder clichés.`;

  try {
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: [{ role: 'user', content: prompt }] })
    });
    const data = await res.json();
    const text = data.content?.[0]?.text || '';
    if (!text) throw new Error('Leeg antwoord');

    const uid = await getUserId();
    await sb.from('plan').insert({ user_id: uid, doel: goal, inhoud: text });
    document.getElementById('plan-display').style.display = 'block';
    document.getElementById('plan-generator').style.display = 'none';
    document.getElementById('plan-goal-title').textContent = goal;
    document.getElementById('plan-content-display').innerHTML = md(text);
    showToast('Plan opgeslagen.');
  } catch(err) {
    showToast('Fout: ' + err.message, 'error');
  }
  document.getElementById('plan-btn').style.display = 'block';
  document.getElementById('plan-loading').style.display = 'none';
}

// HELPERS
async function getUserId() {
  const { data: { user } } = await sb.auth.getUser();
  return user?.id;
}

// TRAINING
async function saveTraining() {
  if (!sb) return;
  const uid = await getUserId();
  const row = {
    user_id: uid,
    datum: document.getElementById('t-date').value,
    type: document.getElementById('t-type').value,
    duur_min: parseInt(document.getElementById('t-duration').value) || null,
    afstand_km: parseFloat(document.getElementById('t-distance').value) || null,
    rpe: parseInt(document.getElementById('t-rpe').value),
    oefeningen: document.getElementById('t-exercises').value,
    notities: document.getElementById('t-notes').value,
  };
  const { error } = await sb.from('trainingen').insert(row);
  if (error) { showToast('Fout: ' + error.message, 'error'); return; }
  showToast('Training opgeslagen.');
  document.getElementById('t-duration').value = '';
  document.getElementById('t-distance').value = '';
  document.getElementById('t-exercises').value = '';
  document.getElementById('t-notes').value = '';
  loadDashboard();
}

async function loadTrainingHistory() {
  if (!sb) return;
  const { data } = await sb.from('trainingen').select('*').order('datum', { ascending: false }).limit(50);
  const el = document.getElementById('training-history-list');
  if (!data || data.length === 0) { el.innerHTML = '<div class="empty"><div class="empty-icon">◎</div><p>Nog geen trainingen gelogd.</p></div>'; return; }
  el.innerHTML = data.map(t => `
    <div class="log-item">
      <div class="log-date">${t.datum}</div>
      <div>
        <div class="log-title">${t.type.charAt(0).toUpperCase() + t.type.slice(1)}</div>
        <div class="log-meta">${t.duur_min ? t.duur_min + ' min' : ''}${t.afstand_km ? ' · ' + t.afstand_km + ' km' : ''} · RPE ${t.rpe}</div>
        ${t.oefeningen ? `<div style="font-size:12px;color:var(--muted);margin-top:4px;white-space:pre-line">${t.oefeningen}</div>` : ''}
      </div>
      <div class="log-badge">${t.type}</div>
    </div>`).join('');
}

// WELLBEING
async function saveWellbeing() {
  if (!sb) return;
  const uid = await getUserId();
  const row = {
    user_id: uid,
    datum: document.getElementById('w-date').value,
    slaap_uren: parseFloat(document.getElementById('w-sleep').value),
    slaap_kwaliteit: parseInt(document.getElementById('w-sleepq').value),
    vermoeidheid: parseInt(document.getElementById('w-fatigue').value),
    stress: parseInt(document.getElementById('w-stress').value),
    spierpijn: parseInt(document.getElementById('w-soreness').value),
    notities: document.getElementById('w-notes').value,
  };
  const { error } = await sb.from('welzijn').upsert(row, { onConflict: 'datum' });
  if (error) { showToast('Fout: ' + error.message, 'error'); return; }
  showToast('Welzijn opgeslagen.');
  loadDashboard();
}

async function loadWellbeingHistory() {
  if (!sb) return;
  const { data } = await sb.from('welzijn').select('*').order('datum', { ascending: false }).limit(30);
  const el = document.getElementById('wellbeing-history-list');
  if (!data || data.length === 0) { el.innerHTML = '<div class="empty"><div class="empty-icon">◎</div><p>Nog geen welzijn gelogd.</p></div>'; return; }
  el.innerHTML = data.map(w => {
    const score = Math.round(10 - (w.vermoeidheid + w.stress + w.spierpijn) / 3);
    const cls = score >= 7 ? 'ind-green' : score >= 5 ? 'ind-orange' : 'ind-red';
    return `<div class="log-item">
      <div class="log-date">${w.datum}</div>
      <div>
        <div class="log-title"><span class="indicator ${cls}"></span>Welzijn score ${score}/10</div>
        <div class="log-meta">Slaap: ${w.slaap_uren}u · Vermoeidheid: ${w.vermoeidheid} · Stress: ${w.stress} · Spierpijn: ${w.spierpijn}</div>
      </div>
    </div>`;
  }).join('');
}

// INJURIES
async function saveInjury() {
  if (!sb) return;
  const uid = await getUserId();
  const row = {
    user_id: uid,
    datum: document.getElementById('inj-date').value,
    lichaamsdeel: document.getElementById('inj-part').value,
    type: document.getElementById('inj-type').value,
    pijnscore: parseInt(document.getElementById('inj-pain').value),
    notities: document.getElementById('inj-notes').value,
  };
  const { error } = await sb.from('blessures').insert(row);
  if (error) { showToast('Fout: ' + error.message, 'error'); return; }
  showToast('Blessure geregistreerd.');
  document.getElementById('inj-notes').value = '';
}

async function loadInjuriesHistory() {
  if (!sb) return;
  const { data } = await sb.from('blessures').select('*').order('datum', { ascending: false });
  const el = document.getElementById('injuries-history-list');
  if (!data || data.length === 0) { el.innerHTML = '<div class="empty"><div class="empty-icon">◌</div><p>Geen blessures geregistreerd.</p></div>'; return; }
  el.innerHTML = data.map(b => {
    const cls = b.pijnscore >= 7 ? 'ind-red' : b.pijnscore >= 4 ? 'ind-orange' : 'ind-green';
    return `<div class="log-item">
      <div class="log-date">${b.datum}</div>
      <div>
        <div class="log-title"><span class="indicator ${cls}"></span>${b.lichaamsdeel.charAt(0).toUpperCase() + b.lichaamsdeel.slice(1)}</div>
        <div class="log-meta">${b.type} · Pijn: ${b.pijnscore}/10</div>
        ${b.notities ? `<div style="font-size:12px;color:var(--muted);margin-top:4px">${b.notities}</div>` : ''}
      </div>
      <div class="log-badge">${b.pijnscore}/10</div>
    </div>`;
  }).join('');
}

// TESTS
async function saveTest() {
  if (!sb) return;
  const uid = await getUserId();
  const row = {
    user_id: uid,
    datum: document.getElementById('tst-date').value,
    zwem_500: document.getElementById('tst-swim').value || null,
    pullups: parseInt(document.getElementById('tst-pullups').value) || null,
    pushups: parseInt(document.getElementById('tst-pushups').value) || null,
    situps: parseInt(document.getElementById('tst-situps').value) || null,
    loop_15mijl: document.getElementById('tst-run15').value || null,
    loop_5mijl: document.getElementById('tst-run5').value || null,
    overig: document.getElementById('tst-custom').value || null,
  };
  const { error } = await sb.from('testresultaten').insert(row);
  if (error) { showToast('Fout: ' + error.message, 'error'); return; }
  showToast('Testresultaat opgeslagen.');
  ['tst-swim','tst-pullups','tst-pushups','tst-situps','tst-run15','tst-run5','tst-custom'].forEach(id => document.getElementById(id).value = '');
}

async function loadTestsHistory() {
  if (!sb) return;
  const { data } = await sb.from('testresultaten').select('*').order('datum', { ascending: false });
  const el = document.getElementById('tests-history-list');
  if (!data || data.length === 0) { el.innerHTML = '<div class="empty"><div class="empty-icon">◆</div><p>Geen testresultaten gelogd.</p></div>'; return; }
  el.innerHTML = data.map(t => `
    <div class="log-item">
      <div class="log-date">${t.datum}</div>
      <div>
        <div class="log-title">PST Test</div>
        <div class="log-meta" style="line-height:1.8">
          ${t.zwem_500 ? `Zwemmen 500m: ${t.zwem_500}<br>` : ''}
          ${t.pullups ? `Pull-ups: ${t.pullups}<br>` : ''}
          ${t.pushups ? `Push-ups: ${t.pushups}<br>` : ''}
          ${t.situps ? `Sit-ups: ${t.situps}<br>` : ''}
          ${t.loop_15mijl ? `1.5 mijl: ${t.loop_15mijl}<br>` : ''}
          ${t.loop_5mijl ? `5 mijl: ${t.loop_5mijl}<br>` : ''}
          ${t.overig ? t.overig : ''}
        </div>
      </div>
    </div>`).join('');
}

// DASHBOARD
async function loadDashboard() {
  if (!sb) return;
  const { data: trainingen } = await sb.from('trainingen').select('*').order('datum', { ascending: false });
  const { data: welzijn } = await sb.from('welzijn').select('*').order('datum', { ascending: false }).limit(7);

  // Stats
  document.getElementById('ds-trainingen').textContent = trainingen?.length || 0;

  // Streak
  let streak = 0;
  if (trainingen && trainingen.length > 0) {
    const dates = [...new Set(trainingen.map(t => t.datum))].sort().reverse();
    const today = new Date().toISOString().split('T')[0];
    let check = today;
    for (const d of dates) {
      if (d === check) { streak++; const prev = new Date(check); prev.setDate(prev.getDate()-1); check = prev.toISOString().split('T')[0]; }
      else break;
    }
  }
  document.getElementById('ds-streak').textContent = streak + 'd';

  // Sleep avg
  if (welzijn && welzijn.length > 0) {
    const avgSleep = (welzijn.reduce((s,w) => s + (w.slaap_uren||0), 0) / welzijn.length).toFixed(1);
    const avgWelzijn = Math.round(welzijn.reduce((s,w) => s + (10 - (w.vermoeidheid+w.stress+w.spierpijn)/3), 0) / welzijn.length);
    document.getElementById('ds-slaap').textContent = avgSleep + 'u';
    document.getElementById('ds-welzijn').textContent = avgWelzijn + '/10';
  } else {
    document.getElementById('ds-slaap').textContent = '—';
    document.getElementById('ds-welzijn').textContent = '—';
  }

  // Recent trainingen
  const rtEl = document.getElementById('dash-recent-trainingen');
  if (trainingen && trainingen.length > 0) {
    rtEl.innerHTML = trainingen.slice(0,5).map(t => `
      <div class="log-item">
        <div class="log-date">${t.datum}</div>
        <div>
          <div class="log-title">${t.type.charAt(0).toUpperCase()+t.type.slice(1)}</div>
          <div class="log-meta">${t.duur_min ? t.duur_min+'min' : ''}${t.afstand_km ? ' · '+t.afstand_km+'km' : ''} · RPE ${t.rpe}</div>
        </div>
      </div>`).join('');
  }

  // Welzijn vandaag
  const wEl = document.getElementById('dash-welzijn-status');
  if (welzijn && welzijn.length > 0) {
    const w = welzijn[0];
    const score = Math.round(10 - (w.vermoeidheid + w.stress + w.spierpijn) / 3);
    const cls = score >= 7 ? 'ind-green' : score >= 5 ? 'ind-orange' : 'ind-red';
    wEl.innerHTML = `
      <div class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px">
          <span class="indicator ${cls}" style="width:12px;height:12px"></span>
          <span style="font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700">${score}/10</span>
          <span style="font-size:12px;color:var(--muted)">${w.datum}</span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:12px;color:var(--muted)">
          <div>Slaap: <span style="color:var(--text)">${w.slaap_uren}u</span></div>
          <div>Vermoeidheid: <span style="color:var(--text)">${w.vermoeidheid}/10</span></div>
          <div>Stress: <span style="color:var(--text)">${w.stress}/10</span></div>
          <div>Spierpijn: <span style="color:var(--text)">${w.spierpijn}/10</span></div>
        </div>
      </div>`;
  } else {
    wEl.innerHTML = '<div style="font-size:13px;color:var(--muted)">Nog niet gelogd vandaag.</div>';
  }
}

// PROGRESS CHARTS
let charts = {};

async function loadProgress() {
  if (!sb) return;

  const { data: trainingen } = await sb.from('trainingen').select('*').order('datum', { ascending: true });
  const { data: welzijn } = await sb.from('welzijn').select('*').order('datum', { ascending: true });
  const { data: tests } = await sb.from('testresultaten').select('*').order('datum', { ascending: true });

  const chartDefaults = {
    responsive: true, maintainAspectRatio: false,
    plugins: { legend: { labels: { color: '#666', font: { size: 11 } } } },
    scales: {
      x: { ticks: { color: '#666', font: { size: 10 } }, grid: { color: '#1a1a1a' } },
      y: { ticks: { color: '#666', font: { size: 10 } }, grid: { color: '#1a1a1a' } }
    }
  };

  // Volume chart
  if (charts.volume) charts.volume.destroy();
  if (trainingen && trainingen.length > 0) {
    const last30 = trainingen.filter(t => new Date(t.datum) >= new Date(Date.now() - 30*24*60*60*1000));
    const byDate = {};
    last30.forEach(t => { byDate[t.datum] = (byDate[t.datum]||0) + (t.duur_min||0); });
    const labels = Object.keys(byDate).sort();
    charts.volume = new Chart(document.getElementById('chart-volume'), {
      type: 'bar',
      data: { labels, datasets: [{ label: 'Minuten', data: labels.map(l => byDate[l]), backgroundColor: 'rgba(200,169,110,0.6)', borderColor: '#c8a96e', borderWidth: 1 }] },
      options: { ...chartDefaults }
    });
  }

  // Wellbeing chart
  if (charts.wellbeing) charts.wellbeing.destroy();
  if (welzijn && welzijn.length > 0) {
    const labels = welzijn.map(w => w.datum);
    charts.wellbeing = new Chart(document.getElementById('chart-wellbeing'), {
      type: 'line',
      data: {
        labels,
        datasets: [
          { label: 'Slaap (u)', data: welzijn.map(w => w.slaap_uren), borderColor: '#4a6b8a', tension: 0.3, pointRadius: 3 },
          { label: 'Vermoeidheid', data: welzijn.map(w => w.vermoeidheid), borderColor: '#b34444', tension: 0.3, pointRadius: 3 },
          { label: 'Stress', data: welzijn.map(w => w.stress), borderColor: '#c8883a', tension: 0.3, pointRadius: 3 },
        ]
      },
      options: { ...chartDefaults }
    });
  }

  // PST progress
  const pstEl = document.getElementById('pst-progress-card');
  if (tests && tests.length >= 2) {
    const rows = tests.map(t => `
      <tr>
        <td>${t.datum}</td>
        <td>${t.zwem_500 || '—'}</td>
        <td>${t.pullups || '—'}</td>
        <td>${t.pushups || '—'}</td>
        <td>${t.situps || '—'}</td>
        <td>${t.loop_15mijl || '—'}</td>
      </tr>`).join('');
    pstEl.innerHTML = `
      <table>
        <thead><tr><th>Datum</th><th>Zwemmen</th><th>Pull-ups</th><th>Push-ups</th><th>Sit-ups</th><th>1.5 mijl</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>`;
  }
}
</script>
</body>
</html>
